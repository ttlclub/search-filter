<!-- <script type="text/discourse-plugin" version="0.8">
    api.onPageChange(function () {
      if($("a#sort-topic-order")[0]){
        const ascending="?ascending=true&order=created"
        const decending="?order=created"
        let a=$("a#sort-topic-order")[0];
        if(window.location.search.match("ascending")){
          a.href=decending;
          a.style="transform:rotate(180deg);"
        }else{
          a.href=ascending;
        }
      }
  });
</script> -->

<script type="text/discourse-plugin" version="0.10.0">
  // text/discourse-plugin
  // const I18n = require("I18n").default;
  // I18n.translations[I18n.locale].js.filters.topliked = { help: "Top Liked" };

  // sort by topic create time (new 2 old)
  api.addNavigationBarItem({
    displayName: "最新发布",
    name: "最新发布",
    before: "top",
    customHref: (category, args, router) => {
      // console.log(navItem, category, args, router);
      const sortOrderParam = "?order=created";
      if (router) {
        let href = router._router.currentURL.replace(
          /\/l\/latest$|\/l\/new$|\/l\/unread$|\/l\/top|\/latest$|\/new$|\/unread$|\/top$/g,
          ""
        );
        href = href ? href + sortOrderParam : "/latest?order=created";
        return href;
      }
    },
    href: "/latest?order=created",
    forceActive: (category, args, router) => {
      const queryParams = router.currentRoute.queryParams;
      // console.log(router.currentRoute);
      return (
        queryParams &&
        Object.keys(queryParams).length === 1 &&
        queryParams["order"] === "created"
      );
    },
  });
</script>
<script type="text/discourse-plugin" version="0.8">

     function replaceFontWarning (text) {
         while (text !== (text = text.replace(/\[warning=([^\]]+)\]((?:(?!\[warning=[^\]]+\]|\[\/warning\])[\S\s])*)\[\/warning\]/ig, function (match, p1, p2) {
           return `<div class="warning-among-text" color='${p1}'>${p2}</font>`;
         })));
         return text;
       }

    // api.onPageChange(function () {
      // if($(".cooked".length>0)){
        // console.log("init warning");
        // $.each($(".cooked"),(index,value)=>{value.innerText=replaceFontWarning(value.innerText)})
     //  }
  // });
</script>

<!-- <script type="text/discourse-plugin" version="0.8">
    api.modifyClass("route:user",{
        pluginId: "my-user-index",
        redirect: function() {
            console.log("haha");
            this.transitionTo("user.profile-hidden");

        },

    });
    
</script>
<script type="text/discourse-plugin" version="0.8">
    api.modifyClass("controller:topic", {
        pluginId: "my-filter-poster",
        firstPost: alias("topic.postStream.posts.0"),

        filterParticipant(post) {
            this.get("model.postStream")
              .filterParticipant(post.username)
              .then(() => this.updateQueryParams);
        },

    });
</script> -->

<script type="text/discourse-plugin" version="0.8">
  api.modifyClass("component:topic-notifications-button", {
      pluginId: "my-topic-notifications-button",
      appendReason: false,
      showFullTitle: false,
  });
</script>
<!-- <script type="text/discourse-plugin" version="0.8">
  api.replaceIcon('trophy', 'mora');
</script> -->

<!-- <script type="" version="0.8.24">
  // text/discourse-plugin
  // https://github.com/B-iggy/alien-night-discourse-dark-theme/blob/master/common/head_tag.html
  api.decorateWidget('header-buttons:after', helper => {
      const showExtraInfo = helper.attrs.topic;
      
      if(!showExtraInfo) {
          return helper.h('a.theme-switcherWrapper', [
              helper.h('a.theme-switcher--light', {
                  text: 'Light',
                  title: 'Change the Theme Color to Light'
              }),
              helper.h('input.theme-switcherBox.theme-switcher #theme-switcher', {
                  type:'checkbox'
              }),
              helper.h('label.theme-switcherLabel', {
              'attributes': {
                  'for': 'theme-switcher'
              }
              }),
              helper.h('a.theme-switcher--dark', {
                  text:'Dark',
                  title: 'Change the Theme Color to Dark'
              })
          ]);
      }
  });
  
    $(document).ajaxComplete(function() {
      $(".theme-switcher").on('change', function() {
        if ($(this).is(':checked')) {
          $('html').addClass('dark');
          localStorage.setItem('theme', 'dark');
          $('.theme-switcher').prop('checked', true);
        }
        else {
          $('html').removeClass('dark');
          localStorage.removeItem('theme', 'dark');
          $('.theme-switcher').prop('checked', false);
        }
      });
    });
  
    $( document ).ready(function() {
      $(window).scroll(function() {
  
        if ($('.contents').find('.extra-info-wrapper').length > 0) {
          // Scrolled Top
        } else {
          if ($('html').hasClass('dark')) {
            $('.theme-switcher').prop('checked', true);
  
          } else {
            $('.theme-switcher').prop('checked', false);
          }
        }
  
        $(".theme-switcher").on('change', function() {
          if ($(this).is(':checked')) {
            $('html').addClass('dark');
            localStorage.setItem('theme', 'dark');
            $('.theme-switcher').prop('checked', true);
          }
          else {
            $('html').removeClass('dark');
            localStorage.removeItem('theme', 'dark');
            $('.theme-switcher').prop('checked', false);
          }
        });
  
        $('.theme-switcher--light').on('click', function() {
          $('html').removeClass('dark');
          $('.theme-switcher').prop('checked', false);
  
          if ($('html').hasClass('dark')) {
            localStorage.setItem('theme', 'dark');
  
          } else {
            localStorage.setItem('theme', 'light');
          }
        });
  
        $('.theme-switcher--dark').on('click', function() {
          $('html').addClass('dark');
          $('.theme-switcher').prop('checked', true);
  
          if ($('html').hasClass('dark')) {
            localStorage.setItem('theme', 'dark');
  
          } else {
            localStorage.setItem('theme', 'light');
          }
        });
      });
  
      $(".theme-switcher").on('change', function() {
        if ($(this).is(':checked')) {
          $('html').addClass('dark');
          localStorage.setItem('theme', 'dark');
          $('.theme-switcher').prop('checked', true);
        }
        else {
          $('html').removeClass('dark');
          localStorage.removeItem('theme', 'dark');
          $('.theme-switcher').prop('checked', false);
        }
      });
  
      $('.theme-switcher--light').on('click', function() {
        $('html').removeClass('dark');
        $('.theme-switcher').prop('checked', false);
  
        if ($('html').hasClass('dark')) {
          localStorage.setItem('theme', 'dark');
  
        }else{
          localStorage.setItem('theme', 'light');
        }
      });
  
      $('.theme-switcher--dark').on('click', function() {
        $('html').addClass('dark');
        $('.theme-switcher').prop('checked', true);
  
        if ($('html').hasClass('dark')) {
          localStorage.setItem('theme', 'dark');
        }else{
          localStorage.setItem('theme', 'light');
        }
      });
  
  
      if (typeof(localStorage) !== "undefined") {
        if (localStorage.getItem("theme") === 'dark' || localStorage.getItem("theme") === null && !settings.default_light) {
          $('html').addClass('dark');
          $('.theme-switcher').prop('checked', true);
        } else {
          $('html').removeClass('dark');
          $('.theme-switcher').prop('checked', false);
          localStorage.removeItem('theme', 'dark');
        }
      } else {
      // Sorry! No Web Storage support..
      console.log('Upgrade to a better browser! Really!')
      }
    });
  
  </script> -->
